Join
====

Not all the data that can be used in a GIS environment are strictly geospatial. Tabular data without direct geospatial references may be used as well, but they have to be linked to other geospatial data through a join operation. A join operation establishes a 1 to 1 relationship between the rows of the tabular data and the rows of the vector data attribute table. In order to create a join, the user has to identify a field, called key, that exists in both tables and on which the correspondence is based.

The table Population.csv contains the number of inhabitants of all the municipalities around the lakes. Let us suppose that we want to add this information to the existing shapefile Municipalities_on_lakes.shp (that we have previously created). In this case, the key is represented by the municipality name that exists in both files.

First, we have to add the table to the QGIS project (look at :numref:`2.4.3.1`). Select **Layer → Add Layer → Add Delimited Text Layer**. Specify the table path, check the option **Custom delimiters**, **Others** and type “**;**”. Check **First record has field names** and **Detect field types**. Check **No geometry (attribute only table)**. Finally, click **OK**. Once the table is added, we have to create the join. To this end, right-click on the layer Municipalities_on_lakes and click **Properties**. In the tab **Joins**, click the button **Add new join** (plus symbol) and set the following parameters. **Join layer**: Population (table), **Join field**: NOME_COM, **Target field**: Name. Click **OK** and then **OK** again. All the steps are shown in :numref:`2.4.3.2`.

.. _2.4.3.1:
.. figure:: /img/2/2.4.3.1.PNG
   
    -- How to add the tabular file Population.csv in QGIS.

.. _2.4.3.2:
.. figure:: /img/2/2.4.3.2.PNG
   
    -- Join between Municipalities_on_lakes.shp and Population.csv.

As a result, the fields of Population.csv have been added to the attribute table of Municipalities_on_lakes.shp. As shown in :numref:`2.4.3.2`, in some cases there is no correspondence between the names of the municipalities in the two files, therefore we find the value “NULL” in the cell. This is due to the fact that the information comes from different sources and in particular the table Population.csv only regards the municipalities around lakes Maggiore, Como and Lugano (while the other file also regards other lakes, like lake Varese). In most cases the correspondence exists anyway.

It is very important to highlight that join is a temporary operation and it does not change the original data. This means that if we want to save the joined table, we have to export it into another shapefile: click on the layer Municipalities_on_lakes **→ Export → Save Features As**. Let us call the new shapefile Municipalities_on_lakes_pop.shp and save it in the folder that contains all the other data.

If we open the attribute table of this shapefile (Municipalities_on_lakes_pop.shp), we can see that the fields coming from the join operation with the table Population.csv do not have appropriate names. These names have been assigned by default by QGIS, but it is preferable to change them for the next steps.

In particular, the field containing the number of inhabitants of each municipality is called “Populati_1” and the field containing the province is called “Population”. In order to change the name of these fields, we can use the tool Refactor Fields: in the **Processing Toolbox** (gear symbol in the top menu of QGIS), search for **Refactor Fields** and double-click to open the configuration interface.

Select as **Input layer** Municipalities_on_lakes_pop; change the name of the fields “Population” (Text) and “Population_1” (Whole number), respectively, into “Province” and “Population”. Then, choose an adequate path for the output and call it “Municipalities”. Finally, select **Run**. :numref:`2.4.3.3` shows the procedure just described.

.. _2.4.3.3:
.. figure:: /img/2/2.4.3.3.PNG
   
    -- Configuration interface of the tool Refactor Fields, that allows to change, for instance, the fields name of an attribute table.